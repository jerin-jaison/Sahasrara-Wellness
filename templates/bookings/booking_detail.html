{% extends "bookings/base_booking.html" %}
{% block title %}Booking Details — Sahasrara Wellness{% endblock %}

{% block back_url %}{% url 'bookings:inbox' %}{% endblock %}

{% block content %}
<div class="booking-title-wrapper">
    <div class="booking-divider"></div>
    <h4 class="booking-title text-center">Booking Details</h4>
    <p class="text-muted small">Appointment #{{ booking.id_short }}</p>

    <a href="{% url 'bookings:inbox' %}" class="btn-back-stylish">
        <i class="bi bi-arrow-left"></i> My Bookings
    </a>
</div>

<div class="premium-card mx-auto" style="max-width: 800px;">
    <div class="detail-summary">
        <!-- Main Service Card -->
        <div class="premium-card mb-3 p-4 text-center" style="background: var(--surface-gradient);">
            {% if booking.status == 'CONFIRMED' or booking.status == 'confirmed' %}
            <div class="status-badge-premium confirmed mb-3">Confirmed</div>
            {% elif booking.status == 'PENDING_PAYMENT' or booking.status == 'pending' %}
            <div class="status-badge-premium pending mb-3">Pending Payment</div>
            {% else %}
            <div class="status-badge-premium mb-3">{{ booking.status|upper }}</div>
            {% endif %}

            <h4 class="fw-bold text-white mb-1">{{ booking.service.name }}</h4>
            <div class="h5 text-white mb-0">₹{{ booking.service.price }}</div>
        </div>

        <!-- Appointment Info Grid -->
        <div class="row g-3 mb-4">
            <div class="col-6">
                <div class="summary-item-premium h-100">
                    <small class="text-muted text-uppercase fw-bold d-block mb-1"
                        style="font-size:0.6rem;letter-spacing:1px">Date</small>
                    <div class="fw-bold text-white">{{ booking.booking_date|date:"d M Y" }}</div>
                    <div class="small text-muted">{{ booking.booking_date|date:"l" }}</div>
                </div>
            </div>
            <div class="col-6">
                <div class="summary-item-premium h-100">
                    <small class="text-muted text-uppercase fw-bold d-block mb-1"
                        style="font-size:0.6rem;letter-spacing:1px">Time</small>
                    <div class="fw-bold text-white">{{ booking.start_time|time:"g:i A" }}</div>
                    <div class="small text-white">{{ booking.service.duration_minutes }}m session</div>
                </div>
            </div>
            <div class="col-12">
                <div class="summary-item-premium">
                    <small class="text-muted text-uppercase fw-bold d-block mb-1"
                        style="font-size:0.6rem;letter-spacing:1px">Location & Therapist</small>
                    <div class="fw-bold text-white mb-1">{{ booking.branch.name|cut:"Sahasrara Wellness – " }}</div>
                    <div class="small text-muted"><i class="bi bi-person-heart gold"></i> {{ booking.worker.name }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-grid gap-3">
            {% if booking.status == 'PENDING_PAYMENT' or booking.status == 'pending' %}
            <a href="{% url 'payments:initiate' booking.id %}" class="btn btn-wellness py-3">Complete Payment</a>
            {% endif %}

            {% if booking.status == 'CONFIRMED' or booking.status == 'COMPLETED' or booking.status == 'confirmed' %}
            <a href="{% url 'payments:receipt' booking.id %}?token={{ booking.access_token }}"
                class="btn btn-wellness py-3">
                <i class="bi bi-receipt me-2"></i> View Receipt
            </a>
            {% endif %}

            <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text={{ booking.service.name|urlencode }}&dates={{ booking.booking_date|date:'Ymd' }}T{{ booking.start_time|time:'His' }}Z/{{ booking.booking_date|date:'Ymd' }}T{{ booking.end_time|time:'His' }}Z&location={{ booking.branch.address|urlencode }}"
                target="_blank" class="btn btn-outline-light border-secondary py-3 text-white">
                <i class="bi bi-calendar-plus me-2"></i> Add to Calendar
            </a>
        </div>
    </div>

    <style>
        .summary-item-premium {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 16px;
        }

        .status-badge-premium {
            display: inline-block;
            padding: 0.35rem 1rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 1px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-badge-premium.confirmed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border-color: rgba(40, 167, 69, 0.2);
        }

        .status-badge-premium.pending {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border-color: rgba(255, 193, 7, 0.2);
        }

        .gold {
            color: var(--gold);
        }
    </style>
</div>
{% endblock %}